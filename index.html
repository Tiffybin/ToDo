<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Main.elm</title>
	<style>
		body {
			padding: 0;
			margin: 0;
		}
	</style>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<link href="style.css" rel="stylesheet">

</head>

<body>
	<div id="firebaseui-auth-container"></div>
	<div id="elm-app-is-loaded-here"></div>
	<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
	<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css" />
	<script type="module">
		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
		import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyDUKyYu2WFA8J705DuprKOeZ7XAcTpTEO8",
			authDomain: "purescript-todo-backend.firebaseapp.com",
			projectId: "purescript-todo-backend",
			storageBucket: "purescript-todo-backend.firebasestorage.app",
			messagingSenderId: "1098639957007",
			appId: "1:1098639957007:web:b886c394249b659047d77a"
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const authInstance = getAuth(app);

		onAuthStateChanged(authInstance, async (user) => {
			if (user) {
				// User is signed in, see docs for a list of available properties
				// https://firebase.google.com/docs/reference/js/firebase.User

				var elmApp = Elm.Main.init({
					flags: { userId: user.uid, authToken: await user.getIdToken() },
					node: document.getElementById("elm-app-is-loaded-here")
				});
				elmApp.ports.signOut.subscribe(function (_) {
					authInstance.signOut();
					location.reload();
				});

			} else {
				// FirebaseUI config.
				const uiConfig = {
					signInSuccessUrl: '.',
					signInOptions: [
						firebase.auth.EmailAuthProvider.PROVIDER_ID,
					],
					callbacks: {
						signInSuccessWithAuthResult: function (authResult, redirectUrl) {
							console.log(authResult);
							// Process result. This will not trigger on merge conflicts.
							// On success redirect to signInSuccessUrl.
							return true;
						},
					}
				};

				// Initialize the FirebaseUI Widget using Firebase.
				const ui = new firebaseui.auth.AuthUI(authInstance);
				// The start method will wait until the DOM is loaded.
				ui.start('#firebaseui-auth-container', uiConfig);
			}
		});
	</script>
	<script src="main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
</body>

</html>